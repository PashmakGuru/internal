name: Bootstrap Terraform Cloud
on: workflow_dispatch

env:
  TOKEN: ${{ secrets.TFC_API_TOKEN }}
  ORG_NAME: ${{ vars.TFC_ORGANIZATION }}
  ORG_EMAIL: nasiri.amirreza.96@gmail.com

jobs:
  bootstrap-tfe:
    name: Bootstrap Terraform Cloud
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v3
    - uses: hashicorp/setup-terraform@v3
      with:
        terraform_version: "1.6.3"
    - name: Init, Plan and Apply
      run: |
        cd terraform-modules/tfc-bootstrap
        cat << EOF > terraform.tfvars
        api_token="${{ env.TOKEN }}"
        organization_name="${{ env.ORG_NAME }}"
        organization_email="${{ env.ORG_EMAIL }}"
        EOF
        terraform init
        terraform plan
        terraform apply

